'''
Author: tu155 13293356554@163.com
Date: 2025-03-21 21:41:14
LastEditors: tu155 13293356554@163.com
LastEditTime: 2025-03-21 22:10:31
FilePath: \项目计划\latest_start.py
Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
'''
def calculate_lst(have_re_flow, d, last_start):
    n = len(d)
    lst = [float('inf')] * n
    lst[-1] = last_start
    
    # 构建每个活动的前驱列表
    predecessors = [[] for _ in range(n)]
    for i in range(n):
        for j in range(n):
            if have_re_flow[i][j]:
                predecessors[j].append(i)
    
    from collections import deque
    queue = deque()
    queue.append(n-1)
    
    while queue:
        current = queue.popleft()
        for pred in predecessors[current]:
            new_lst = lst[current] - d[pred]
            if new_lst < lst[pred]:
                lst[pred] = new_lst
                queue.append(pred)
    
    return lst
# 示例使用
have_re_flow = [
    [0, 1, 1, 0],  # 活动0指向活动1和3
    [0, 0, 0, 1],  # 活动1指向活动2和4
    [0, 0, 0, 1],  # 活动2指向活动3和4
    [0, 0, 0, 0]   # 活动3指向活动0和2
]

d = [2,3, 4,3]  # 活动持续时间
end_time = 6  # 最后一个活动的开始时间
d=[4.0, 16.0, 4.0, 4.0, 4.0, 10.0, 4.0, 4.0, 22.0, 4.0, 11.0, 5.0, 4.0, 4.0, 4.0, 4.0]
have_re_flow=[[0, 1.0, 1.0, 1.0, 1.0, -0.0, -0.0, -0.0, 1.0, 1.0, -0.0, 1.0, -0.0, -0.0, 1.0, 1.0], [0.0, 0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0], [0.0, 0.0, 0, 1.0, -0.0, 1.0, -0.0, 0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0, 1.0, -0.0, 1.0, 0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, -0.0], [0.0, 0.0, 0.0, 0.0, 0, -0.0, -0.0, 1.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 1.0], [0.0, 0.0, 0.0, -0.0, -0.0, 0, -0.0, 0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 1.0], [0.0, 0.0, 0.0, 0.0, -0.0, -0.0, 0, 0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 1.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 1.0], [0.0, -0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0], [0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 0.0, 0, 1.0, -0.0, 1.0, -0.0, 0.0, -0.0], [0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 0.0, 0.0, 0, 1.0, -0.0, 1.0, 0.0, -0.0], [0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 0.0, 0.0, 0.0, 0, -0.0, -0.0, 1.0, 1.0], [0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 0.0, 0.0, -0.0, -0.0, 0, -0.0, 0.0, 1.0], [0.0, 0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 1.0, 0, 0.0, 1.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 1.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0]]
end_time=50
latest_start_times = calculate_lst(have_re_flow, d, end_time)
print("所有活动的最晚开始时间:", latest_start_times)